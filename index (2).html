<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>P29-23_13.geojson 地図表示</title>

  <!-- Leaflet の CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    .leaflet-popup-content {
      margin: 8px 12px;
    }
    .facility-name {
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
    }
    .facility-type {
      font-size: 0.9rem;
      margin-bottom: 2px;
    }
    .facility-address {
      font-size: 0.9rem;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet の JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // 学校種別コード → 名称のマッピング
    const schoolTypeMap = {
      "16001": "小学校",
      "16002": "中学校",
      "16003": "中等教育学校",
      "16004": "高等学校",
      "16005": "高等専門学校",
      "16006": "短期大学",
      "16007": "大学",
      "16011": "幼稚園",
      "16012": "特別支援学校",
      "16013": "幼保連携型認定こども園",
      "16014": "義務教育学校",
      "16015": "各種学校",
      "16016": "専修学校"
    };

    // 地図を初期化（日本付近をざっくり表示）
    const map = L.map("map").setView([36.0, 138.0], 5);

    // ベースマップ（OpenStreetMap）
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    // GeoJSON ファイルを読み込み（同じフォルダに P29-23_13.geojson がある前提）
    fetch("P29-23_13.geojson")
      .then(response => {
        if (!response.ok) {
          throw new Error("GeoJSON の読み込みに失敗しました: " + response.statusText);
        }
        return response.json();
      })
      .then(data => {
        // GeoJSON レイヤーを作成
        const geojsonLayer = L.geoJSON(data, {
          pointToLayer: function (feature, latlng) {
            // マーカーのスタイル（小さな円）
            return L.circleMarker(latlng, {
              radius: 5,
              weight: 1,
              opacity: 1,
              fillOpacity: 0.8
            });
          },
          onEachFeature: function (feature, layer) {
            const p = feature.properties || {};

            const code = (p.P29_003 != null) ? String(p.P29_003) : "";
            const typeName = schoolTypeMap[code] || (code ? "種別コード: " + code : "種別不明");

            const name = p.P29_004 || "名称不明";
            const address = p.P29_005 || "";

            let popupHtml = "";
            popupHtml += `<span class="facility-name">${name}</span>`;
            popupHtml += `<div class="facility-type">種別：${typeName}</div>`;
            if (address) {
              popupHtml += `<div class="facility-address">住所：${address}</div>`;
            }

            layer.bindPopup(popupHtml);
          }
        }).addTo(map);

        // すべてのポイントが収まるように地図範囲を調整
        const bounds = geojsonLayer.getBounds();
        if (bounds.isValid()) {
          map.fitBounds(bounds);
        }
      })
      .catch(error => {
        console.error(error);
        alert("GeoJSON の読み込み中にエラーが発生しました。\nコンソールを確認してください。");
      });
  </script>
</body>
</html>
